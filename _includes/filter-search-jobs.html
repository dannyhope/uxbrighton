<script>
  (function() {
    // Variables to store the filter search results
    const options = {valueNames: ['job-text', 'job-excerpt']}; // The classes to search for
    const jobList = new List('job-list-filter', options); // Uses the List.js library to filter the results

    // Function to filter the results based on the search parameter
    function filterResultsBySearchParam(searchParam) {
      // Loop through all list items and show/hide based on the search parameter
      jobList.filter((item) => {
        const summaryText = item.values()['job-text']; // Get the summaryText of the list item
        const excerptFull = item.values()['job-excerpt']; // Get the excerptFull of the list item

        return (
          summaryText.toLowerCase().includes(searchParam) ||
          excerptFull.toLowerCase().includes(searchParam)
        );
      });
    }

    // Function to get the search parameter from the URL hash
    function getSearchParamFromURL() {
      const hash = window.location.hash; // Get the hash from the URL
      if (hash.startsWith("#")) {
        return hash.slice(1); // Remove the "#" from the hash
      }
      return ""; // Return an empty string if there is no hash
    }

    // Apply the filter on page load based on the search parameter in the URL
    const searchParam = getSearchParamFromURL();
    // Only apply the filter if there is a search parameter
    if (searchParam) {
      filterResultsBySearchParam(searchParam.toLowerCase());
    }

    // Function to update the URL with the search parameter
    function updateURL(searchParam) {
      const url = new URL(window.location.href); // Get the current URL
      url.hash = searchParam; // Only set the search term as the URL parameter
      history.replaceState(null, "", url); // Replace the current URL with the new one
    }

    // Add event listeners to all links on the page
    const links = document.querySelectorAll("a");
    links.forEach((link) => {
      link.addEventListener("click", (event) => {
        const href = link.getAttribute("href");
        // Only update the URL if the link is a hash link
        if (href.startsWith("#")) {
          const searchParam = href.slice(1); // Remove the "#" from the link
          updateURL(searchParam); // Update the URL with the search parameter
          filterResultsBySearchParam(searchParam.toLowerCase()); // Filter the results based on the search parameter
          event.preventDefault(); // Prevent the default behaviour of the link
        }
      });
    });
  })();
</script>
